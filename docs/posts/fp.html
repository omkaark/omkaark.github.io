<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
            <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/compass.jpg?raw=true">
            <title>Floating point maths made simple - Omkaar Kamath</title>
            <meta name="description" content="Floating point maths made simple - Personal blog post">
            <meta property="og:title" content="Floating point maths made simple - Omkaar Kamath">
            <meta property="og:description" content="Floating point maths made simple - Personal blog post">
            <meta property="og:type" content="article">
            <meta property="og:url" content="https://omkaark.com/posts/fp.html">
            <meta property="og:image" content="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/floats.png?raw=true">
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:title" content="Floating point maths made simple - Omkaar Kamath">
            <meta name="twitter:description" content="Floating point maths made simple - Personal blog post">
            <meta name="twitter:image" content="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/floats.png?raw=true">
        

    <style>
    /* ---------- TYPOGRAPHY SYSTEM (rem/em only) ---------- */
:root {
  /* One knob to rule them all. Change this in media query to scale everything. */
  --base: 1rem;           /* 1rem = browser default (usually 16px) */
  --scale: 1.25;          /* modular scale ratio: Major Third */

  /* Precomputed steps off the base using the scale (no px anywhere) */
  --step-0:  calc(var(--base) * 1.25);
  --step-1:  calc(var(--base) * 1.4);
  --step-2:  calc(var(--step-1) * 1.4);
  --step-3:  calc(var(--step-2) * 1.4);
  --step-4:  calc(var(--step-3) * 1.7);
}

/* On mobile, set ONE number (the base) and everything scales automatically */
@media (max-width: 768px) {
  :root {
    --base: 0.95rem;   /* tighten all text ~5%. change to 0.90rem, 1.05rem, etc */
  }
}

/* ---------- GLOBAL ---------- */
html { font-size: 100%; } /* keep user/browser zoom respectful */
body {
  font-family: 'Courier New', 'Monaco', monospace;
  font-size: var(--step-0);
  line-height: 1.5;
  color: #000;
  background: #fff;
  width: 80vw;
  max-width: 50rem; /* 800px -> 50rem for consistency */
  margin: 0 auto;
  padding: 2.5rem 0; /* 40px -> 2.5rem */
}

/* ---------- HEADER ---------- */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2.5rem;
  border-bottom: 0.125rem solid #000; /* 2px -> rem */
  padding-bottom: 1.25rem;           /* 20px -> 1.25rem */
}

.name {
  font-size: var(--step-2);
  font-weight: 700;
  letter-spacing: 0.125rem; /* 2px -> rem */
  text-transform: uppercase;
}

/* ---------- INDEX / POSTS LIST ---------- */
.posts {
  margin-bottom: 5rem;
  font-size: var(--step-1);
}

.post {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1.25rem; /* 12px 20px */
  margin: 1.25rem 0;       /* 20px */
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.post::before {
  content: '';
  position: absolute;
  inset: 0 auto 0 -100%;
  width: 100%;
  background: #FFFDD0;
  transition: left 0.15s ease;
  z-index: -1;
}
.post:hover::before { left: 0; }

.post-hover-gif {
  position: absolute;
  height: 4rem;
  width: 40rem;
  background-image: url("https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/run.gif?raw=true");
  background-repeat: no-repeat;
  background-size: 100%;
  background-position: right;
  opacity: 0;
  pointer-events: none;
  z-index: 10000;
  transition: opacity 120ms ease-in;
}

.post-link:hover .post-hover-gif { 
  opacity: 1; 
}

.post-title { flex: 1; margin-right: 1.25rem; }
.post-link { color: #000; text-decoration: none; font-weight: 400; position: relative; }

.post-date {
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  font-weight: 700;
  font-size: var(--step-0);
}

/* ---------- FOOTER ---------- */
.footer {
  border-top: 0.125rem solid #000;
  padding-top: 1.25rem;
  display: flex;
  gap: 1.875rem; /* 30px */
}

.social-link {
  color: #000;
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 0.0625rem; /* 1px */
  font-weight: 700;
  font-size: var(--step-0);
}
.social-link:hover { text-decoration: underline; }

/* ---------- POST PAGE ---------- */
.post-content {
  margin-bottom: 5rem;
  max-width: 50rem;
  font-size: var(--step-0);
  display: flex;
  flex-direction: column;
  align-items: center;
}

.post-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2.5rem;
  padding-bottom: 1.25rem;
  border-bottom: 0.0625rem solid #000; /* 1px */
}

.back-link {
  color: #000;
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 0.0625rem;
  font-weight: 700;
  font-size: var(--step--1);
}
.back-link:hover { text-decoration: underline; }

/* Headings on the scale */
.post-content h1 {
  margin: 1.875rem 0 1.25rem; /* 30 0 20 */
  font-size: var(--step-3);
  line-height: 1.2;
}

.post-content h2 {
  margin: 1.875rem 0 0.9375rem; /* 30 0 15 */
  font-size: var(--step-2);
  line-height: 1.3;
  width: 100%;
}

.post-content h3 {
  margin: 1.5625rem 0 0.625rem; /* 25 0 10 */
  font-size: var(--step-1);
  line-height: 1.3;
  width: 100%;
}

.post-content h4 {
  margin: 1.425rem 0 0.425rem; /* 25 0 10 */
  font-size: var(--step-0);
  line-height: 1.25;
  width: 100%;
}

.post-content ul {
  width: 90%;
}

.post-content p {
  margin-bottom: 1.25rem; /* 20 */
  line-height: 1.6;
  font-size: var(--step-0);
  font-family: Monaco, monospace;
  width: 100%;
}

.post-content a { color: #000; text-decoration: underline; }
.post-content a:hover { background: #f5f5dc; }

/* Images unaffected by font scale, but spacings use rem for consistency */
.post-content img {
  margin: 1.25rem 0;
  max-width: 100%;
  max-height: 50rem;
  border-radius: 0.5rem; /* 8px */
  display: block;
  margin-left: auto;
  margin-right: auto;
  border: 1px #ccc dashed;
  padding: 10px;
}

/* ---------- INLINE CODE ---------- */
.post-content :not(pre) > code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: var(--step-0);
  background: rgba(127,127,127,.12);
  border: 0.0625rem solid rgba(127,127,127,.25);
  padding: .15em .4em;   /* em ties to current font-size */
  border-radius: .35em;
  word-break: break-word;
}

/* ---------- CODE BLOCKS ---------- */
.post-content pre {
  margin: 1.25rem 0;
  padding: 0.875rem 1rem; /* 14px 16px */
  border-radius: 0.75rem; /* 12px */
  border: 0.0625rem solid rgba(127,127,127,.25);
  background: #f7f7f9;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  tab-size: 2;
  font-size: var(--step-0); /* control block base size */
  line-height: 1.55;
  width: 100%;
}
.post-content pre code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 1em;   /* inherit from pre; keep scale intact */
  line-height: 1.55;
  display: block;
  white-space: pre;
}

/* ---------- TABLES ---------- */
.post-content table {
  border-collapse: collapse;
  width: 100%;
  margin: 2rem 0;
  font-size: var(--step-0);
  font-family: Monaco, monospace;
}

.post-content th,
.post-content td {
  border: 0.0625rem solid #000; /* thin black grid */
  padding: 0.75rem 1rem;
  text-align: left;
  vertical-align: top;
}

.post-content th {
  background: #f5f5f5;
  font-weight: 700;
  letter-spacing: 0.03rem;
  text-transform: uppercase;
}

.post-content tr:nth-child(even) td {
  background: #fafafa;
}

.post-content tr:hover td {
  background: #FFFDD0; /* same yellow hover as posts */
  transition: background 120ms ease-in-out;
}

.post-content table code {
  font-size: 0.95em;
}

/* ---------- RESPONSIVE LAYOUT ONLY (typography scales via --base) ---------- */
@media (max-width: 768px) {
  body { width: 95vw; padding: 1.25rem 0; }

  .header { flex-direction: column; justify-items: center; }

  .post {
    flex-direction: column;
    align-items: flex-start;
    padding: 0.5rem 0.9375rem;
    margin: 1.25rem 0.625rem;
    background: #FFFDD0;
  }
  .post::before { display: none; }

  .post-title { margin-right: 0; margin-bottom: 0.25rem; }

  .footer { flex-wrap: wrap; gap: 0.9375rem; }

  .post-meta { flex-direction: column; align-items: flex-start; gap: 0.625rem; }

  .post-content { margin: 0 0.625rem; }

  .post-link:hover .post-hover-gif { 
    opacity: 0;
  }

  .post-content table {
    font-size: calc(var(--step-0) * 0.9);
  }

  .post-content th,
  .post-content td {
    padding: 0.6rem 0.75rem;
  }
}

    </style>
</head>
<body>
    <header class="header">
        <a href="https://omkaark.github.io" style="text-decoration: none;" class="social-link"><h1 class="name">Omkaar Kamath</h1></a>
        <div>
            <a href="https://twitter.com/omkizzy" class="social-link">Twitter</a>
            <a href="https://linkedin.com/in/omkaark" class="social-link">LinkedIn</a>
            <a href="https://github.com/omkaark" class="social-link">GitHub</a>
            <a href="https://youtube.com/@omkizzy" class="social-link">Youtube</a>
        </div>
    </header>

    
    <main class="post-content">
        <h1>Floating Point math</h1>
<p>I wanted to write about different floating point formats. I am omitting float64, MXFP6, MXFP4 and NVFP4 for this post.</p>
<p><img src="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/floats.png?raw=true" alt="Different float formats" /></p>
<h3>What do mantissa and exponent bits represent?</h3>
<p>The sign bit is as in <code>int</code>, 1 is negative and 0 is positive.</p>
<p>Exponents represents an offset binary number. To calculate the real exponent, calculate <code>exponent - bias</code>. The bias value is 127 for f32/bf16 and 15 for f16.</p>
<p>Mantissa represents the fractional part in binary notation with an implicit leading 1 (add 1 to result). Each mantissa bit represents a negative power of 2, so: <br />
<code>1st bit: 2^-1 = 0.5</code> <br />
<code>2nd bit: 2^-2 = 0.25</code> <br />
<code>3rd bit: 2^-3 = 0.125</code> <br />
...</p>
<p>Now, say <code>10000000</code> is our 8-bit mantissa, it translates to <code>1 + 0.5 = 1.5</code> in base10.</p>
<p>Explore further with the calculator below.</p>
<iframe 
  src="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/calculator.html?raw=true" 
  width="1100" 
  height="250" 
  frameborder="0"
  style="@media(max-width: 600px){body {display: none;}}"
>
</iframe>

<p>In general, for any floating point number (fp32, fp8, fp4, etc), with 1 sign bit, e exponent bits and m mantissa bits, this is the general formula to calculate it's value. Personally, this really helped me understand fp representation.</p>
<p><img src="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/general-form.png?raw=true" alt="General form for any floating point representation" /></p>
<p><br/></p>
<h3>Float32</h3>
<p>This was the default format for ML. Great support across hardware vendors. f32 has about 7 digits of precision, anything beyond that is usually wrong. The only problem is it's memory intensive, do we really need 8 exponent and 23 mantissa bits?</p>
<h3>Float16</h3>
<p>Turns out, no! Float16 hardware support is good but turns out cutting down exponent bits really hurt algorithmic performance of ML models. f16 has about 3 digits of precision.</p>
<h3>Bfloat16</h3>
<p>Enter BF16, with the same 8 exponent bits as float 32 with only 7 mantissa bits. Most new models released on huggingface are now primarily bf16. Hardware + Software support for bf16 is great, making it an instant industry standard. bf16 has about 3 digits of precision too. I'll quote google to explain why bf16 is preferred.</p>
<blockquote cite="https://cloud.google.com/blog/products/ai-machine-learning/bfloat16-the-secret-to-high-performance-on-cloud-tpus">
Based on our years of experience training and deploying a wide variety of neural networks across Googleâ€™s products and services, we knew when we designed Cloud TPUs that neural networks are far more sensitive to the size of the exponent than that of the mantissa. To ensure identical behavior for underflows, overflows, and NaNs, bfloat16 has the same exponent size as FP32. However, bfloat16 handles denormals differently from FP32: it flushes them to zero. Unlike FP16, which typically requires special handling via techniques such as loss scaling [Mic 17], BF16 comes close to being a drop-in replacement for FP32 when training and running deep neural networks.
</blockquote>

<h3>Float8</h3>
<p>fp8 is getting more common for inference, flash-attention-3 already has an fp8 implementation.</p>
<h3>Get mathing</h3>
<p>Checkout these calculators to add and multiply on float16 values.</p>
<iframe 
  src="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/float-add.html?raw=true" 
  width="840" 
  height="320" 
  frameborder="0">
</iframe>

<p><br/></p>
<iframe 
  src="https://raw.githubusercontent.com/omkaark/omkaark.github.io/refs/heads/main/public/3-float-math/float-mul.html?raw=true" 
  width="840" 
  height="320" 
  frameborder="0">
</iframe>

<p>My goal was to write a small blog and cover surface-level details for now. To learn more, I recommend reading <a href="https://jvns.ca/blog/2023/01/13/examples-of-floating-point-problems/#how-does-floating-point-work">this blog</a> by the incredible Julia Evans.</p>
<blockquote>
<p>By Omkaar Kamath</p>
</blockquote>

    </main>
    
</body>
</html>